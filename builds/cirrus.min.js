(function(O,S){typeof exports=="object"&&typeof module<"u"?S(exports):typeof define=="function"&&define.amd?define(["exports"],S):(O=typeof globalThis<"u"?globalThis:O||self,S(O.wApp={}))})(this,function(O){var S=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function G(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var A={exports:{}};(function(e){function t(r,s,o){importClass("VProcess");var h=new VProcess(theRoot),d=s.fields;h.setProcess(r);var v=`\r
`,u="HTTP/1.0 200 OK";delete s.body,delete s.fields;for(var c=Object.keys(s),m=c.length;m--;)c[m].toUpperCase().match(/^[A-Z0-9_]*$/)&&(s[c[m]]instanceof Date?h.setVar(c[m],s[c[m]].toISOString().split("T")[0]):h.setVar(c[m].toUpperCase(),s[c[m]]));h.exec();var p=h.varToString("RESULT"),y="Content-Type: text/html; charset=utf-8";if(p===""){var g=h.result();if(y="Content-Type: application/json",h.objectInfo().outputType()===2&&g.size()>0)p=JSON.stringify(l(g,d));else if(h.objectInfo().outputType()===1){var x=new VRegisterList(theRoot);x.setTable(g.tableInfo().idRef()),x.append(g),p=JSON.stringify(l(x,d))}}var C=["Date: "+new Date().toGMTString(),"Content-Length: "+p.length];C=C.concat(BasicHeaders).concat([y]);var _=u+v+C.join(v)+v+v+(o.isWindows()?p:unescape(encodeURIComponent(p)));return _}function n(r,s){importClass("VQuery");var o=new VQuery(theRoot),h=s.fields;o.setQuery(r);var d=`\r
`,v="HTTP/1.0 200 OK";delete s.body,delete s.fields;for(var u=Object.keys(s),c=u.length;c--;)o.setVar(u[c].toUpperCase(),wApp.getType(s[u[c]]));if(o.exec()){var m=JSON.stringify(l(o.result(),h)),p=["Date: "+new Date().toGMTString(),"Content-Length: "+m.length];p=p.concat(BasicHeaders).concat(["Content-Type: application/json; charset=utf-8"]);var y=v+d+p.join(d)+d+d+m;return y}}function l(r,s){var o=r.tableInfo(),h=o.fieldCount(),d=r.size(),v=[],u=[],c=0,m;if(s===void 0)for(;h--;)m=parseInt(o.fieldType(h),10),c=m===11?parseInt("11"+o.fieldObjectType(h)):m,u.push({fieldName:o.fieldId(h),fieldType:c});else for(s=typeof s=="string"?s.toUpperCase().split(","):s;h--;)s.indexOf(o.fieldId(h))>-1&&(m=parseInt(o.fieldType(h),10),c=m===11?parseInt("11"+o.fieldObjectType(h)):m,u.push({fieldName:o.fieldId(h),fieldType:c}));for(h=u.length;d--;){for(var p=r.readAt(d),y=h,g={};y--;)g[u[y].fieldName]=f(u[y].fieldType,u[y].fieldName,p);v.push(g)}return v}function f(r,s,o){var h=parseInt(r),d;switch(h){case 0:d=o.fieldToString(s);break;case 1:d=o.fieldToString(s);break;case 2:d=o.fieldToString(s);break;case 3:d=o.fieldToString(s);break;case 4:d=o.fieldToString(s);break;case 5:d=o.fieldToString(s);break;case 6:d=o.fieldToDouble(s);break;case 7:d=o.fieldToDate(s);break;case 8:d=o.fieldToDateTime(s);break;case 9:d=o.fieldToDateTime(s);break;case 10:d=o.fieldToBool(s);break;case 11:d="";break;case 111:d=o.fieldToString(s);break;case 112:d=o.fieldToString(s);break;case 12:d="";break;case 13:d="";break;case 14:d="";break;case 15:d="";break;case 18:d="";break;default:d=o.fieldToString(s);break}return d}e.exports&&(e.exports={renderProcess:t,renderQuery:n,vRegisterListToJSON:l,mapField:f})})(A);var L=A.exports,U={exports:{}};(function(e){function t(){this.buffer=[]}t.prototype.append=function(r){return this.buffer.push(r),this},t.prototype.toString=function(){return this.buffer.join("")};var n={codex:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(r){for(var s=new t,r=new l(r);r.moveNext();){var v=r.current;r.moveNext();var o=r.current;r.moveNext();var h=r.current,d=v>>2,v=(v&3)<<4|o>>4,u=(o&15)<<2|h>>6,c=h&63;isNaN(o)?u=c=64:isNaN(h)&&(c=64),s.append(this.codex.charAt(d)+this.codex.charAt(v)+this.codex.charAt(u)+this.codex.charAt(c))}return s.toString()},decode:function(r){for(var s=new t,r=new f(r);r.moveNext();){var o=r.current;if(128>o)s.append(String.fromCharCode(o));else if(191<o&&224>o){r.moveNext();var h=r.current;s.append(String.fromCharCode((o&31)<<6|h&63))}else r.moveNext(),h=r.current,r.moveNext(),s.append(String.fromCharCode((o&15)<<12|(h&63)<<6|r.current&63))}return s.toString()}};function l(r){this._input=r,this._index=-1,this._buffer=[]}l.prototype={current:Number.NaN,moveNext:function(){if(0<this._buffer.length)return this.current=this._buffer.shift(),!0;if(this._index>=this._input.length-1)return this.current=Number.NaN,!1;var r=this._input.charCodeAt(++this._index);return r==13&&this._input.charCodeAt(this._index+1)==10&&(r=10,this._index+=2),128>r?this.current=r:(127<r&&2048>r?this.current=r>>6|192:(this.current=r>>12|224,this._buffer.push(r>>6&63|128)),this._buffer.push(r&63|128)),!0}};function f(r){this._input=r,this._index=-1,this._buffer=[]}f.prototype={current:64,moveNext:function(){if(0<this._buffer.length)return this.current=this._buffer.shift(),!0;if(this._index>=this._input.length-1)return this.current=64,!1;var r=n.codex.indexOf(this._input.charAt(++this._index)),s=n.codex.indexOf(this._input.charAt(++this._index)),o=n.codex.indexOf(this._input.charAt(++this._index)),h=n.codex.indexOf(this._input.charAt(++this._index)),d=(o&3)<<6|h;return this.current=r<<2|s>>4,o!=64&&this._buffer.push((s&15)<<4|o>>2),h!=64&&this._buffer.push(d),!0}},e.exports&&(e.exports=n)})(U);var $=U.exports,w=L,k=w.renderProcess,F=w.renderQuery,V=w.vRegisterListToJSON,M=w.mapField,E=$,T={version:"1.4",isWindows:function(){return theApp.sysInfo().getOsString().match(/win/i)},config:{filesTable:"cirrusdat/FILES_MEM",root_path:"D://cirrus"},router:{params:{body:{}},parse_params:function(e){for(var t=e.length;t--;){var n=e[t].split("=");this.params[n[0]]=n[1].replace(/\+/g," ")}},routes:[],rexRoutes:[],addRoutes:function(e){for(var t=Object.keys(e),n=t.length;n--;)if(t[n].split(" ")[0]=="resource"){var l=this.createREST(t[n].split(" ")[1]);this.addRoutes(l)}else{var f={},r=t[n];f[r]=e[r];var s=new RegExp(r.replace(/:\w+/g,"([\\w@.]+)")+"/?$","i");this.rexRoutes.unshift(s),this.routes.unshift(f)}},createREST:function(e){var t={};return t["GET /"+e]=e+"Controller#index",t["GET /"+e+"/new"]=e+"Controller#new",t["POST /"+e]=e+"Controller#create",t["GET /"+e+"/:id"]=e+"Controller#show",t["GET /"+e+"/:id/edit"]=e+"Controller#edit",t["PUT /"+e+"/:id"]=e+"Controller#update",t["DELETE /"+e+"/:id"]=e+"Controller#delete",t},pointRequest:function(e){var t=this.rexRoutes.length;for(i=0;i<t;i++){var n=this.rexRoutes[i],l=e.match(n);if(l){var f=this.routes[i],r=Object.keys(f)[0],s=r.match(/:(\w+)/g);if(s){var o=e.match(n);for(o.shift(),t=s.length;t--;){var h=s[t];this.params[h.replace(":","")]=decodeURIComponent(o[s.indexOf(h)])}}return f[r]}}return"NOT FOUND"}},session:{cookie_name:"v7App",cookie:{session:{}},session:{},flash:{},flashGet:{},flashSet:{},setFlash:function(e,t){return this.changed=!0,this.flashSet[e]=t,!0},getFlash:function(e){return this.flashGet[e]},changed:!1,set:function(e,t){return this.changed=!0,this.session[e]=t,!0},get:function(e){return this.session[e]},setInHeader:function(){var e,t,n="";Object.keys(this.flashSet).length>0&&(this.session.flash=this.flashSet,this.flashSet={}),Object.keys(this.session).length!==0&&(e=this.session.expires,t=this.session.path,delete this.session.expires,delete this.session.path,n=E.encode(encodeURIComponent(JSON.stringify(this.session))));var l=this.cookie_name+"="+n;return e!==void 0&&(l+="; expires="+e.toGMTString()),t!==void 0&&(l+="; path="+t),"set-Cookie: "+l},getFromHeader:function(e){var t=new RegExp(T.session.cookie_name+"=(\\w+)\\;?"),n={},l=T.cookie_name,f=e.match(t);return f&&(n[l]=f[1],a=E.decode(n[l]),b=decodeURIComponent(a),n.session=JSON.parse(b.replace(/\0/g,"")),this.cookie=n,this.session=n.session,this.session.flash!==void 0&&(this.flashGet=this.session.flash,delete this.session.flash,this.changed=!0)),n[l]}},params:function(){return this.router.params},responseHeaders:{headers:{},set:function(e,t){this.headers[e]=t},buildForHTTP:function(){var e=Object.keys(this.headers),t=e.length,n=[];for(z=0;z<t;z++)n.push(e[z]+": "+this.headers[e[z]]);return n}},request:W,response:K,logError:j,getHTML:I,vRegisterListToJSON:V,renderProcess:k,renderQuery:F,mapField:M,getType:Q};function B(e,t){for(var n=e.split(`\r
\r
`),l=n[0].match(/^(GET|POST|PUT|DELETE|UPDATE|OPTIONS) (.+) (.+)[\r\n]?/),f=n[0].replace(/^(GET|POST|PUT|DELETE|UPDATE|OPTIONS) (.+) (.+)[\r\n]?/,""),r=/(.+): (.+)/g,s=/([^&]+)=([^&]+)/g,o=l[2].split("?"),h=o[0].match(/\.(\w+)$/i),d={verb:l[1],path:l[2],protocol:l[3],url:o[0],extension:h?h[1].toLowerCase():void 0,encodeParams:o[1],decodeParams:{},headers:{},body:{},bodyDecoded:{},cookie:""};header=r.exec(f);)d.headers[header[1]]=header[2];var v=d.encodeParams;if(d.encodeParams)for(var u,c,m;param=s.exec(v);)c=decodeURIComponent(param[1]).replace("[]",""),u=T.getType(decodeURIComponent(param[2]).replace(/\+/g," ")),m=d.decodeParams[c],m===void 0?d.decodeParams[c]=decodeURIComponent(param[1]).match(/^.*\[\]$/)?[u]:u:(typeof m!="object"&&(d.decodeParams[c]=[m]),d.decodeParams[c].push(u));if(n.length==2)for(v=d.body=n[1].trim().replace(/\+/g," ");body=s.exec(v);)if(body[1]=="_method"&&decodeURIComponent(body[2]).match(/^(PUT|DELETE)$/i))d.verb=decodeURIComponent(body[2]).toUpperCase();else{var p=decodeURIComponent(body[1]).replace("[]",""),y=d.bodyDecoded[p],g=T.getType(decodeURIComponent(body[2]));y===void 0?d.bodyDecoded[p]=g:(typeof y!="object"&&(d.bodyDecoded[p]=[y]),d.bodyDecoded[p].push(g))}return d}function W(e){try{var t=B(e);return T.router.params=t.decodeParams,t.bodyDecoded!==void 0&&(T.router.params.body=t.bodyDecoded),t.headers["Content-Type"]!==void 0&&t.headers["Content-Type"].match(/application\/json/i)&&t.body?T.router.params.body=JSON.parse(t.body):t.headers["Content-Type"]!==void 0&&t.headers["Content-Type"].match(/text\/xml/i)&&t.body?T.router.params.body=t.body:T.router.params.body=t.bodyDecoded,t.headers.Cookie!==void 0&&T.session.getFromHeader(t.headers.Cookie),t}catch(n){return n}}function Q(e){var t=/^[1-9]\d*$/i,n=/^\d*,\d*$/i,l=/^\d*\.\d*$/i,f=/^\d{1,3}(\.\d{3})*(\,\d*)?$/g,r=/^\d{1,3}(\,\d{3})*(\.\d*)?$/g,s=/(true|false)/,o=/^\d{1,2}[\/-]\d{1,2}[\/-]\d{2,4}$/,h=/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/,d=/^\d{1,2}[\/-]\d{1,2}[\/-]\d{2,4} \d{1,2}:\d{1,2}:\d{1,2} \w\w$/,v=/^\w*, \d* \w* \d{2,4} \d{1,2}:\d{1,2}:\d{1,2} \w\w\w$/,u=/^\d{2,4}-\d{1,2}-\d{1,2}T\d{1,2}:\d{1,2}:\d{1,2}\.\d*Z$/,c,m,p,y,g,x,C,_,N;if(e.match(t)&&e.length<14)return parseInt(e,10);if(e.match(f))return parseFloat(e.replace(/\./g,"").replace(",","."));if(e.match(r))return parseFloat(e.replace(/\,/g,""));if(e.match(n))return parseFloat(e.replace(",","."));if(e.match(l))return parseFloat(e);if(e.match(s))return e=="true";if(e.match(o))return c=e.split("/"),m=e.split("-"),p=c.length>1?c:m,y=new Date(parseInt(p[2],10),parseInt(p[1],10)-1,parseInt(p[0],10)),y;if(e.match(h))return c=e.split("/"),m=e.split("-"),p=c.length>1?c:m,y=new Date(parseInt(p[0],10),parseInt(p[1],10)-1,parseInt(p[2],10)),y;if(e.match(d)){p=e.split(" ");var P=p[0].split("/"),D=p[1].split(":"),ne=p[2].match(/am/i)?parseInt(D[0]):parseInt(D[0])+12;return y=new Date(parseInt(P[2],10),parseInt(P[0],10)-1,parseInt(P[1],10),ne,parseInt(D[1],10),parseInt(D[2],10)),y}if(e.match(v)){var re={Jan:1,Feb:2,Mar:3,Apr:4,May:5,Jun:6,Jul:7,Aug:8,Sep:9,Oct:10,Nov:11,Dec:12};return p=e.split(",")[1].split(" "),C=parseInt(p[0],10),x=re[p[1]],g=parseInt(p[2],10),hour=parseInt(parmas[3].split(":")[0],10),_=parseInt(parmas[3].split(":")[1],10),N=parseInt(parmas[3].split(":")[2],10),y=new Date(g,x,C,hour,_,N),y}return e.match(u)?(p=e.split("T"),c=p[0],m=p[1].split(".")[0],g=parseInt(c.split("-")[0],10),x=parseInt(c.split("-")[1],10)-1,C=parseInt(c.split("-")[2],10),hour=parseInt(m.split(":")[0],10),_=parseInt(m.split(":")[1],10),N=parseInt(m.split(":")[2],10),y=new Date(g,x,C,hour,_,N),y):e}var R=["Server: Velneo v7","Access-Control-Allow-Origin: *","Access-Control-Allow-Headers: DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type","Access-Control-Allow-Methods: GET, POST, PUT, HEAD, OPTIONS, DELETE"];typeof S<"u"&&(S.BasicHeaders=R);function K(e){try{if(e.name=="SyntaxError")throw e;var t={js:"application/javascript",css:"text/css",woff:"application/font-woff",ttf:"application/font-sfnt",svg:"image/svg+xml",eot:"application/vnd.ms-fontobject"};if(t[e.extension]!==void 0){var n=I(e.url);return n.html!==""?H(n,t[e.extension],T):"HTTP/1.0 404 NOT FOUND"}else if(e.extension==="pro"){var l=T.router.pointRequest(e.verb+" "+e.url);return l!="NOT FOUND"?k(l,T.router.params,T):"HTTP/1.0 404 NOT FOUND"}else if(e.extension==="bus"){var f=T.router.pointRequest(e.verb+" "+e.url);return f!="NOT FOUND"?F(f,T.router.params):"HTTP/1.0 404 NOT FOUND"}else if(e.verb==="OPTIONS"){var r=`\r
`,s=["Access-Control-Allow-Origin: *","Access-Control-Allow-Headers: DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type","Access-Control-Allow-Methods: GET, POST, PUT, HEAD, OPTIONS, DELETE"];return"HTTP/1.0 204 OK"+r+s.join(r)+r+r}else{var o=T.router.pointRequest(e.verb+" "+e.url.split(".")[0]);if(o!="NOT FOUND"){var h=o.split("#");return Y(h[0],h[1],T,e)}else{var d=I("/views"+e.url);if(d.html!==""){var v=I("/layouts/application"),u=v.html===""?"#yield":v.html,c=u.replace("#yield",d.html);return H({html:c},"text/html; charset=utf-8",T)}else return"HTTP/1.0 404 NOT FOUND"}}}catch(p){switch(p.name){case"SyntaxError":return J(p,"Unable to parse JSON string");default:var m=j(p);return J(p,m)}}}function H(e,t,n){var l=`\r
`,f="HTTP/1.0 200 OK",r=unescape(encodeURIComponent(e.html)),s=["Date: "+new Date().toGMTString(),"Content-Length: "+r.length];e.useCache&&(s.push("Cache-Control: max-age="+e.maxAge),s.push("ETag: "+e.eTag)),s=s.concat(R).concat(["Content-Type: "+t]);var o=f+l+s.join(l)+l+l+r;return o}function X(e){var t=`\r
`,n=unescape(encodeURIComponent(JSON.stringify({message:"Unauthorized"}))),l=R.concat(['WWW-Authenticate: Basic realm="'+(e||"cirrus")+'"']),f="HTTP/1.0 401 Unauthorized"+t+l.join(t)+t+t+n;return f}function Z(e,t){var n=E.decode(t.headers.Authorization.split(" ")[1]).split(":");return e.authentication.username==n[0]&&e.authentication.password==n[1]}function Y(e,t,n,l){var f=`\r
`,r=l.extension||l.headers.Accept,s=n[e].authentication!==void 0&&typeof n[e].authentication=="object"&&n[e].authentication.username!==""&&n[e].authentication.password!=="",o=((n[e].authentication||{}).actions||[]).indexOf(t)>-1||(n[e].authentication||{}).all;if(s&&o&&(l.headers.Authorization===void 0||Z(n[e],l)===!1))return X(n[e].authentication.namespace);n[e].before!==void 0&&typeof n[e].before=="function"&&(n.router.params=n[e].before(n.router.params));var h=n.router.params.redirect_to!==void 0,d=h?n.router.params:n[e][t](n.router.params,l);r=r||"json",d.redirect_to&&(r="redirect");var v=r.match(/(html|xml|json|redirect)/i)||["json"],u=q[v[0]](d,n,e,t),c=["Date: "+new Date().toGMTString(),"Content-Length: "+(u.body?u.body.length:"0")];c=c.concat(R).concat(u.headers).concat(n.responseHeaders.buildForHTTP()),T.session.changed&&c.push(T.session.setInHeader());var m=u.verb+f+c.join(f)+f+f+u.body;return m}var q={json:function(e,t){var n=e.responseCode!==void 0&&e.responseCode.code!==void 0&&e.responseCode.message!==void 0?"HTTP/1.0 "+e.responseCode.code+" "+e.responseCode.message:"HTTP/1.0 200 OK";delete e.responseCode;var l=t.router.params.callback;e=l?l+"("+JSON.stringify(e)+")":JSON.stringify(e),e=unescape(encodeURIComponent(e));var f=["Content-Type: application/"+(l?"javascript":"json")+"; charset=utf-8"];return{verb:n,body:e,headers:f}},html:function(e,t,n,l){var f="HTTP/1.0 200 OK",r,s;if(typeof e=="object"){var o=e.layout||"application",h="/views/"+n.replace("Controller","")+"/"+l,d;if(e.controller=n,e.action=l,e.session=T.session.session,e.flash=T.session.flashGet,e.layout!==!1){var v=I("/layouts/"+o);v.type==="template"&&(layout_temp=Handlebars.compile(v.html)),r=v.type==="template"?layout_temp(e):v.html}else r="#yield";var u=I(h);u.type==="template"&&(d=Handlebars.compile(u.html)),u.html===""&&(u.html="<div><h1>There is not view for this action</h1></div>");var c=u.type==="template"?d(e):u.html;s=r.replace("#yield",c)}else s=e;var m=["Content-Type: text/html; charset=utf-8"];return{verb:f,body:t.isWindows()?s:unescape(encodeURIComponent(s)),headers:m}},xml:function(e,t){var n="HTTP/1.0 200 OK",l=["Content-Type: text/xml; charset=UTF-8"],f;return e.xml?f=t.isWindows()?e.xml:unescape(encodeURIComponent(e.xml)):f="<?xml version='1.0' encoding='UTF-8'?><error version='1.0'>The JSON object should have an xml key</error>",{verb:n,body:f,headers:l}},redirect:function(e){var t="HTTP/1.0 302 Found",n=["location: "+e.redirect_to];return{verb:t,body:"",headers:n}}};function I(e){importClass("VTextFile"),importClass("VFile");var t=e.split(".")[e.split(".").length-1].match(/(css|js|html|woff|ttf|svg|eot)/i)===null?".html":"";e+=t;var n=new VTextFile(T.config.root_path+e),l=new VTextFile(T.config.root_path+e+".hbs"),f=l.exists()?"template":"html";return n.exists()?n.open(VFile.OpenModeReadOnly)?html=n.readAll():html="":l.exists()&&l.open(VFile.OpenModeReadOnly)?html=l.readAll():html="",{html,type:f}}function j(e){return e.lineNumber===void 0?e.message:e.message+". In Line Number: "+e.lineNumber}function J(e,t){var n=`\r
`,l=T.router.params.callback,f={message:t};f=l?l+"("+JSON.stringify(f)+")":JSON.stringify(f),f=unescape(encodeURIComponent(f));var r="HTTP/1.0 500 INTERNAL SERVER ERROR"+n+R.join(n)+n+n+f;return r}var ee=T;const te=G(ee);O.default=te,Object.defineProperties(O,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
