function StringBuffer(){this.buffer=[]}StringBuffer.prototype.append=function(a){this.buffer.push(a);return this};StringBuffer.prototype.toString=function(){return this.buffer.join("")};
var Base64={codex:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var c=new StringBuffer;for(a=new Utf8EncodeEnumerator(a);a.moveNext();){var b=a.current;a.moveNext();var d=a.current;a.moveNext();var e=a.current,f=b>>2,b=(b&3)<<4|d>>4,g=(d&15)<<2|e>>6,h=e&63;isNaN(d)?g=h=64:isNaN(e)&&(h=64);c.append(this.codex.charAt(f)+this.codex.charAt(b)+this.codex.charAt(g)+this.codex.charAt(h))}return c.toString()},decode:function(a){var c=new StringBuffer;for(a=new Base64DecodeEnumerator(a);a.moveNext();){var b=
a.current;if(128>b)c.append(String.fromCharCode(b));else if(191<b&&224>b){a.moveNext();var d=a.current;c.append(String.fromCharCode((b&31)<<6|d&63))}else a.moveNext(),d=a.current,a.moveNext(),c.append(String.fromCharCode((b&15)<<12|(d&63)<<6|a.current&63))}return c.toString()}};function Utf8EncodeEnumerator(a){this._input=a;this._index=-1;this._buffer=[]}
Utf8EncodeEnumerator.prototype={current:Number.NaN,moveNext:function(){if(0<this._buffer.length)return this.current=this._buffer.shift(),!0;if(this._index>=this._input.length-1)return this.current=Number.NaN,!1;var a=this._input.charCodeAt(++this._index);13==a&&10==this._input.charCodeAt(this._index+1)&&(a=10,this._index+=2);128>a?this.current=a:(127<a&&2048>a?this.current=a>>6|192:(this.current=a>>12|224,this._buffer.push(a>>6&63|128)),this._buffer.push(a&63|128));return!0}};
function Base64DecodeEnumerator(a){this._input=a;this._index=-1;this._buffer=[]}
Base64DecodeEnumerator.prototype={current:64,moveNext:function(){if(0<this._buffer.length)return this.current=this._buffer.shift(),!0;if(this._index>=this._input.length-1)return this.current=64,!1;var a=Base64.codex.indexOf(this._input.charAt(++this._index)),c=Base64.codex.indexOf(this._input.charAt(++this._index)),b=Base64.codex.indexOf(this._input.charAt(++this._index)),d=Base64.codex.indexOf(this._input.charAt(++this._index)),e=(b&3)<<6|d;this.current=a<<2|c>>4;64!=b&&this._buffer.push((c&15)<<
4|b>>2);64!=d&&this._buffer.push(e);return!0}};var Handlebars={};
(function(a,c){a.VERSION="1.0.0-rc.4";a.COMPILER_REVISION=3;a.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:">= 1.0.0-rc.4"};a.helpers={};a.partials={};var b=Object.prototype.toString;a.registerHelper=function(c,d,e){if("[object Object]"===b.call(c)){if(e||d)throw new a.Exception("Arg not supported with multiple helpers");a.Utils.extend(this.helpers,c)}else e&&(d.not=e),this.helpers[c]=d};a.registerPartial=function(c,d){"[object Object]"===b.call(c)?a.Utils.extend(this.partials,c):this.partials[c]=
d};a.registerHelper("helperMissing",function(a){if(2===arguments.length)return c;throw Error("Could not find property '"+a+"'");});a.registerHelper("blockHelperMissing",function(c,d){var e=d.inverse||function(){},f=d.fn,n=b.call(c);"[object Function]"===n&&(c=c.call(this));return!0===c?f(this):!1===c||null==c?e(this):"[object Array]"===n?0<c.length?a.helpers.each(c,d):e(this):f(c)});a.K=function(){};a.createFrame=Object.create||function(b){a.K.prototype=b;b=new a.K;a.K.prototype=null;return b};a.logger=
{DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,methodMap:{0:"debug",1:"info",2:"warn",3:"error"},log:function(b,c){if(a.logger.level<=b){var d=a.logger.methodMap[b];"undefined"!==typeof console&&console[d]&&console[d].call(console,c)}}};a.log=function(b,c){a.logger.log(b,c)};a.registerHelper("each",function(b,c){var d=c.fn,e=c.inverse,f=0,k="",g;c.data&&(g=a.createFrame(c.data));if(b&&"object"===typeof b)if(b instanceof Array)for(var h=b.length;f<h;f++)g&&(g.index=f),k+=d(b[f],{data:g});else for(h in b)b.hasOwnProperty(h)&&
(g&&(g.key=h),k+=d(b[h],{data:g}),f++);0===f&&(k=e(this));return k});a.registerHelper("if",function(c,d){"[object Function]"===b.call(c)&&(c=c.call(this));return!c||a.Utils.isEmpty(c)?d.inverse(this):d.fn(this)});a.registerHelper("unless",function(b,c){return a.helpers["if"].call(this,b,{fn:c.inverse,inverse:c.fn})});a.registerHelper("with",function(b,c){if(!a.Utils.isEmpty(b))return c.fn(b)});a.registerHelper("log",function(b,c){var d=c.data&&null!=c.data.level?parseInt(c.data.level,10):1;a.log(d,
b)});var d="description fileName lineNumber message name number stack".split(" ");a.Exception=function(a){for(var b=Error.prototype.constructor.apply(this,arguments),c=0;c<d.length;c++)this[d[c]]=b[d[c]]};a.Exception.prototype=Error();a.SafeString=function(a){this.string=a};a.SafeString.prototype.toString=function(){return this.string.toString()};var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},f=/[&<>"'`]/g,g=/[&<>"'`]/,h=function(a){return e[a]||"&amp;"};a.Utils=
{extend:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])},escapeExpression:function(b){if(b instanceof a.SafeString)return b.toString();if(null==b||!1===b)return"";b=b.toString();return g.test(b)?b.replace(f,h):b},isEmpty:function(a){return a||0===a?"[object Array]"===b.call(a)&&0===a.length?!0:!1:!0}};a.VM={template:function(b){var c={escapeExpression:a.Utils.escapeExpression,invokePartial:a.VM.invokePartial,programs:[],program:function(b,c,d){var e=this.programs[b];d?e=a.VM.program(b,
c,d):e||(e=this.programs[b]=a.VM.program(b,c));return e},programWithDepth:a.VM.programWithDepth,noop:a.VM.noop,compilerInfo:null};return function(d,e){e=e||{};var f=b.call(c,a,d,e.helpers,e.partials,e.data),g=c.compilerInfo||[],h=g[0]||1,l=a.COMPILER_REVISION;if(h!==l){if(h<l)throw"Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+a.REVISION_CHANGES[l]+") or downgrade your runtime to an older version ("+a.REVISION_CHANGES[h]+
").";throw"Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+g[1]+").";}return f}},programWithDepth:function(a,b,c){var d=Array.prototype.slice.call(arguments,3),e=function(a,e){e=e||{};return b.apply(this,[a,e.data||c].concat(d))};e.program=a;e.depth=d.length;return e},program:function(a,b,c){var d=function(a,d){d=d||{};return b(a,d.data||c)};d.program=a;d.depth=0;return d},noop:function(){return""},invokePartial:function(b,
d,e,f,g,h){f={helpers:f,partials:g,data:h};if(b===c)throw new a.Exception("The partial "+d+" could not be found");if(b instanceof Function)return b(e,f);if(a.compile)return g[d]=a.compile(b,{data:h!==c}),g[d](e,f);throw new a.Exception("The partial "+d+" could not be compiled when running in runtime-only mode");}};a.template=a.VM.template})(Handlebars);wApp={router:{params:{body:{}},parse_params:function(a){for(var c=a.length;c--;){var b=a[c].split("=");this.params[b[0]]=b[1].replace(/\+/g," ")}},routes:[],rexRoutes:[],addRoutes:function(a,c){if(0===Object.keys(this.routes).length||"rest"==c)for(var b=Object.keys(a),d=b.length;d--;)if("resource"==b[d].split(" ")[0]){var e=this.createREST(b[d].split(" ")[1]);this.addRoutes(e,"rest")}else{var e={},f=b[d];e[f]=a[f];f=RegExp(f.replace(/:\w+/g,"([\\w\\W]+)")+"/?$","i");this.rexRoutes.unshift(f);this.routes.unshift(e)}},
createREST:function(a){var c={};c["GET /"+a]=a+"Controller#index";c["GET /"+a+"/new"]=a+"Controller#new";c["POST /"+a]=a+"Controller#create";c["GET /"+a+"/:id"]=a+"Controller#show";c["GET /"+a+"/:id/edit"]=a+"Controller#edit";c["PUT /"+a+"/:id"]=a+"Controller#update";c["DELETE /"+a+"/:id"]=a+"Controller#delete";return c},pointRequest:function(a){var c=this.rexRoutes.length;for(i=0;i<c;i++){var b=this.rexRoutes[i];if(a.match(b)){var d=this.routes[i],e=Object.keys(d)[0],f=e.match(/:(\w+)/g);if(f)for(a=
a.match(b),a.shift(),c=f.length;c--;)b=f[c],this.params[b.replace(":","")]=decodeURIComponent(a[f.indexOf(b)]);return d[e]}}return"NOT FOUND"}},session:{cookie_name:"v7App",cookie:{session:{}},session:{},changed:!1,set:function(a,c){this.changed=!0;this.session[a]=c;return!0},get:function(a){return this.session[a]},setInHeader:function(){var a,c;0!==Object.keys(this.session).length&&(a=this.session.expires,c=this.session.path,delete this.session.expires,delete this.session.path,encoded=Base64.encode(encodeURIComponent(JSON.stringify(this.session))));
var b=this.cookie_name+"="+encoded;void 0!==a&&(b+="; expires="+a.toGMTString());void 0!==c&&(b+="; path="+c);return"set-Cookie: "+b},getFromHeader:function(a){var c={},b=wApp.cookie_name;if(a=a.match(RegExp(wApp.cookie_name+"=(\\w+)\\;?")))c[b]=a[1],c.session=JSON.parse(decodeURIComponent(Base64.decode(c[b]))),this.cookie=c,this.session=c.session;return c[b]}},params:function(){return this.router.params},request:Request,response:Response,logError:logError,getHTML:getHTML};
function http_parser(a,c){for(var b=a.split("\r\n\r\n"),d=b[0].match(/^(GET|POST|PUT|DELETE|UPDATE) (.+) (.+)[\r\n]?/),e=b[0].replace(/^(GET|POST|PUT|DELETE|UPDATE) (.+) (.+)[\r\n]?/,""),f=/(.+): (.+)/g,g=/([^&]+)=([^&]+)/g,h=d[2].split("?"),m=h[0].match(/\.(\w+)$/i),d={verb:d[1],path:d[2],protocol:d[3],url:h[0],extension:m?m[1].toLowerCase():void 0,encodeParams:h[1],decodeParams:{},headers:{},body:{},bodyDecoded:{},cookie:""};header=f.exec(e);)d.headers[header[1]]=header[2];e=decodeURIComponent(d.encodeParams).replace(/\+/g,
" ");if(d.encodeParams)for(;param=g.exec(e);)d.decodeParams[param[1]]=param[2];if(2==b.length)for(e=d.body=decodeURIComponent(b[1].trim().replace(/\+/g," "));body=g.exec(e);)d.bodyDecoded[body[1]]=body[2];return d}function Request(a){a=http_parser(a);wApp.router.params=a.decodeParams;wApp.router.params.body=a.bodyDecoded;void 0!==a.headers.Cookie&&wApp.session.getFromHeader(a.headers.Cookie);return a}
var BasicHeaders=["Server: Velneo v7","transfer-coding: chunked","Keep-Alive: timeout=5, max=94","Connection: Keep-Alive"];function isAsset(a){return"js"===a.extension||"css"===a.extension}
function Response(a){try{if("js"===a.extension||"css"===a.extension){var c=getHTML(a.url).html;if(""!==c){var b="css"===a.url.substr(a.url.length-3)?"text/css":"application/javascript";return renderResponseAssets(c,b)}return"HTTP/1.0 404 NOT FOUND"}if("pro"===a.extension){var d=wApp.router.pointRequest(a.verb+" "+a.url);return"NOT FOUND"!=e?renderProcess(d,wApp.router.params):"HTTP/1.0 404 NOT FOUND"}if("bus"!==a.extension){var e=wApp.router.pointRequest(a.verb+" "+a.url);if("NOT FOUND"!=e){var f=
e.split("#");return renderResponse(f[0],f[1],wApp,a.extension||a.headers.Accept)}return"HTTP/1.0 404 NOT FOUND"}}catch(g){return a=logError(g),renderErrorResponse(g,a)}}function renderResponseAssets(a,c){var b=["Date: "+(new Date).toGMTString(),"Content-Length: "+a.length],b=b.concat(BasicHeaders).concat(["Content-Type: "+c]);return"HTTP/1.0 200 OK\r\n"+b.join("\r\n")+"\r\n\r\n"+a}
function renderResponse(a,c,b,d){var e=b[a][c](b.router.params);d=d||"json";e.redirect_to&&(d="redirect");d=d.match(/(html|json|redirect)/i)||["json"];a=Engine[d[0]](e,b,a,c);c=["Date: "+(new Date).toGMTString(),"Content-Length: "+(a.body?a.body.length:"0")];c=c.concat(BasicHeaders).concat(a.headers);wApp.session.changed&&c.push(wApp.session.setInHeader());return a.verb+"\r\n"+c.join("\r\n")+"\r\n\r\n"+a.body}
function renderProcess(a,c){var b=new VProcess(theRoot);b.setProcess(a);for(var d=Object.keys(c),e=d.length;e--;)b.setVar(d[e].toUpperCase(),c[d[e]]);b.exec();d=b.varToString("RESULT");""===d&&(e=b.result(),2===b.objectInfo().outputType()&&0<e.size()?d=JSON.stringify(vRegisterListToJSON(e,c.fields)):1===b.objectInfo().outputType()&&(b=new VRegisterList(theRoot),b.setTable(e.tableInfo().idRef()),b.append(e),d=JSON.stringify(vRegisterListToJSON(b,c.fields))));b=["Date: "+(new Date).toGMTString(),"Content-Length: "+
d.length];b=b.concat(BasicHeaders).concat(["Content-Type: text/html; charset=utf-8"]);return"HTTP/1.0 200 OK\r\n"+b.join("\r\n")+"\r\n\r\n"+d}
function renderQuery(a,c){var b=new VQuery(theRoot);b.setQuery(processId);for(var d=Object.keys(c),e=d.length;e--;)b.setVar(d[e].toUpperCase(),c[d[e]]);if(b.exec())var f=JSON.stringify(vRegisterListToJSON(b.result(),c.fields));b=["Date: "+(new Date).toGMTString(),"Content-Length: "+f.length];b=b.concat(BasicHeaders).concat(["Content-Type: application/json; charset=utf-8"]);return"HTTP/1.0 200 OK\r\n"+b.join("\r\n")+"\r\n\r\n"+f}
function vRegisterListToJSON(a,c){var b=a.tableInfo(),d=nFields2=b.fieldCount(),e=a.size(),f=[];c=g.toUpperCase().split(",");var g=[];if(void 0===c)for(;d--;)g.push({fieldName:b.fieldId(d),fieldType:b.fieldType(d)});else for(;d--;)-1<c.indexOf(b.fieldId(d))&&g.push({fieldName:b.fieldId(d),fieldType:b.fieldType(d)});for(b.fieldCount();e--;){for(var b=a.readAt(e),d=nFields2,h={};d--;)h[g[d].fieldName]=mapField(g[d].fieldType,g[d].fieldName,b);f.push(h)}return f}
function mapField(a,c,b){a=parseInt(a);switch(a){case 0:case 1:case 2:case 3:case 4:case 5:a=b.fieldToString(c);break;case 6:a=b.fieldToDouble(c);break;case 7:a=b.fieldToDate(c);break;case 8:a=b.fieldToTime(c);break;case 9:a=b.fieldToDateTime(c);break;case 10:a=b.fieldToBool(c);break;default:a=b.fieldToString(c)}return a}
var Engine={json:function(a,c){var b=c.router.params.callback;a=b?b+"("+JSON.stringify(a)+")":JSON.stringify(a);a=unescape(encodeURIComponent(a));return{verb:"HTTP/1.0 200 OK",body:a,headers:["Content-Type: application/"+(b?"javascript":"json")+"; charset=utf-8"]}},html:function(a,c,b,d){c=a.layout||"application";b="/views/"+b.replace("Controller","")+"/"+d;!1!==a.layout?(d=getHTML("/layouts/"+c),"template"==d.type&&eval("layout_temp = "+d.template),d="template"==d.type?Handlebars.VM.template(layout_temp)(a):
d.html):d="#yield";b=getHTML(b);"template"==b.type&&eval("template = "+b.template);a="template"==b.type?Handlebars.VM.template(template)(a):b.html;a=d.replace("#yield",a);return{verb:"HTTP/1.0 200 OK",body:unescape(encodeURIComponent(a)),headers:["Content-Type: text/html; charset=utf-8"]}},redirect:function(a){return{verb:"HTTP/1.0 302 Found",body:"",headers:["location: "+a.redirect_to]}}};
function getHTML(a){var c=new VRegisterList(theRoot);c.setTable("cirrusdat/FILES_MEM");c.load("PATH",[a]);if(0<c.listSize()){var b=c.readAt(0);a=b.fieldToString("BODY");c="1"==b.fieldToString("TIPO")?"html":"template";b=b.fieldToString("COMPILED")}else c.load("NAME",["NOT_VIEW"]),a=c.readAt(0).fieldToString("BODY"),b="",c="html";return{html:a,type:c,template:b}}function logError(a){return void 0===a.lineNumber?a.message:a.message+". In Line Number: "+a.lineNumber}
function renderErrorResponse(a,c){var b=wApp.router.params.callback,d={message:c},d=b?b+"("+JSON.stringify(d)+")":JSON.stringify(d),d=unescape(encodeURIComponent(d));return"HTTP/1.0 500  INTERNAL SERVER ERROR\r\n"+BasicHeaders.join("\r\n")+"\r\n\r\n"+d}
