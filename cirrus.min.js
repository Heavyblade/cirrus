function StringBuffer(){this.buffer=[]}StringBuffer.prototype.append=function(a){this.buffer.push(a);return this};StringBuffer.prototype.toString=function(){return this.buffer.join("")};
var Base64={codex:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){for(var b=new StringBuffer,a=new Utf8EncodeEnumerator(a);a.moveNext();){var c=a.current;a.moveNext();var d=a.current;a.moveNext();var e=a.current,f=c>>2,c=(c&3)<<4|d>>4,h=(d&15)<<2|e>>6,g=e&63;isNaN(d)?h=g=64:isNaN(e)&&(g=64);b.append(this.codex.charAt(f)+this.codex.charAt(c)+this.codex.charAt(h)+this.codex.charAt(g))}return b.toString()},decode:function(a){for(var b=new StringBuffer,a=new Base64DecodeEnumerator(a);a.moveNext();){var c=
a.current;if(128>c)b.append(String.fromCharCode(c));else if(191<c&&224>c){a.moveNext();var d=a.current;b.append(String.fromCharCode((c&31)<<6|d&63))}else a.moveNext(),d=a.current,a.moveNext(),b.append(String.fromCharCode((c&15)<<12|(d&63)<<6|a.current&63))}return b.toString()}};function Utf8EncodeEnumerator(a){this._input=a;this._index=-1;this._buffer=[]}
Utf8EncodeEnumerator.prototype={current:Number.NaN,moveNext:function(){if(0<this._buffer.length)return this.current=this._buffer.shift(),!0;if(this._index>=this._input.length-1)return this.current=Number.NaN,!1;var a=this._input.charCodeAt(++this._index);13==a&&10==this._input.charCodeAt(this._index+1)&&(a=10,this._index+=2);128>a?this.current=a:(127<a&&2048>a?this.current=a>>6|192:(this.current=a>>12|224,this._buffer.push(a>>6&63|128)),this._buffer.push(a&63|128));return!0}};
function Base64DecodeEnumerator(a){this._input=a;this._index=-1;this._buffer=[]}
Base64DecodeEnumerator.prototype={current:64,moveNext:function(){if(0<this._buffer.length)return this.current=this._buffer.shift(),!0;if(this._index>=this._input.length-1)return this.current=64,!1;var a=Base64.codex.indexOf(this._input.charAt(++this._index)),b=Base64.codex.indexOf(this._input.charAt(++this._index)),c=Base64.codex.indexOf(this._input.charAt(++this._index)),d=Base64.codex.indexOf(this._input.charAt(++this._index)),e=(c&3)<<6|d;this.current=a<<2|b>>4;64!=c&&this._buffer.push((b&15)<<
4|c>>2);64!=d&&this._buffer.push(e);return!0}};
wApp={router:{params:{body:{}},parse_params:function(a){for(var b=a.length;b--;){var c=a[b].split("=");this.params[c[0]]=c[1].replace(/\+/g," ")}},routes:{},addRoutes:function(a){for(var b=Object.keys(a),c=b.length;c--;)if("resource"==b[c].split(" ")[0]){var d=this.createREST(b[c].split(" ")[1]);this.addRoutes(d)}else{var d={},e=b[c];d[e]=a[e];this.routes[e.replace(/:\w+/g,"(\\d+)")]=d}},createREST:function(a){var b={};b["GET /"+a]=a+"Controller#index";b["GET /"+a+"/new"]=a+"Controller#new";b["POST /"+
a]=a+"Controller#create";b["GET /"+a+"/:id"]=a+"Controller#show";b["GET /"+a+"/:id/edit"]=a+"Controller#edit";b["PUT /"+a+"/:id"]=a+"Controller#update";b["DELETE /"+a+"/:id"]=a+"Controller#delete";return b},pointRequest:function(a){keys=Object.keys(this.routes);for(var b=keys.length;b--;){var c=RegExp(keys[b].replace(/\//g,"\\/")+"$");if(a.match(c)){var d=this.routes[keys[b]],e=Object.keys(d)[0],f=e.match(/:(\w+)/g);if(f){a=a.match(c);a.shift();for(b=f.length;b--;)c=f[b],this.params[c.replace(":",
"")]=a[f.indexOf(c)]}return d[e]}}return"NOT FOUND"}},cookie:{},session:{},oldcookie:{},setSession:function(){var a=0!=Object.keys(this.session).length?Base64.encode(encodeURIComponent(JSON.stringify(this.session))):"";if(0!=Object.keys(this.session).length){var b=this.session.expires,c=this.session.path;delete this.session.expires;delete this.session.path;a=Base64.encode(encodeURIComponent(JSON.stringify(this.session)))}else c=b=void 0;a="value="+a;void 0!=b&&(a+="; expires="+b.toGMTString());void 0!=
c&&(a+="; path="+c);return"set-Cookie: "+a},cookieChanged:function(){this.cookie.session=this.session;var a=this.cookie,b=this.oldcookie;if(Object.keys(a).length==Object.keys(b).length){for(var c in a)if(a[c]!==b[c])return!0;for(c in b)if(a[c]!==b[c])return!0}else return!0;return!1},getSession:function(a){for(var a=a.split("; "),b=a.length,c={},d={};b--;){var e=a[b].split("=");c[e[0]]=e[1];d[e[0]]=e[1]}c.session=JSON.parse(decodeURIComponent(Base64.decode(c.value)));d.session=c.session;this.cookie=
c;this.oldcookie=d;this.session=c.session;return c.value},params:function(){return this.router.params}};
function Request(a){var b=a.split("\r\n\r\n"),c=b[0].split("\r\n"),a=c[0].trim().split(" ");c.shift();a={verb:a[0],path:a[1],protocol:a[2],url:a[1].split("?")[0],encodeParams:a[1].split("?")[1],headers:{},body:{},cookie:""};if(0!=c.length)for(var d=c.length;d--;){var e=c[d].split(":");a.headers[e[0].trim()]=e[1].trim();"Cookie"==e[0].trim()&&wApp.getSession(e[1].trim())}if(2==b.length&&""!=b[b.length-1]){a.body=decodeURIComponent(b[1].trim());b=a.body.split("&");c=b.length;for(wApp.router.params.body=
{};c--;)d=b[c].split("="),wApp.router.params.body[d[0]]=d[1].replace(/\+/g," ")}"undefined"!=typeof a.encodeParams&&wApp.router.parse_params(decodeURIComponent(a.encodeParams).split("&"));return a}function Response(a){a=wApp.router.pointRequest(a.verb+" "+a.url);"NOT FOUND"!=a?(a=a.split("#"),a=renderResponse(a[0],a[1],wApp)):a="HTTP/1.1 404 NOT FOUND";return a}
function renderResponse(a,b,c){a=c[a][b](c.router.params);a=(b=c.router.params.callback)?b+"("+JSON.stringify(a)+")":JSON.stringify(a);a=unescape(encodeURIComponent(a));b=["Date: "+(new Date).toGMTString(),"Content-Type: application/"+(b?"javascript":"json")+"; charset=utf-8","Content-Length: "+a.length,"Server: Velneo v7","transfer-coding: chunked","Keep-Alive: timeout=5, max=94","Connection: Keep-Alive"];c.cookieChanged()&&b.push(c.setSession());return"HTTP/1.1 200 OK\r\n"+b.join("\r\n")+"\r\n\r\n"+
a};