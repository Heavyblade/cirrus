function StringBuffer(){this.buffer=[]}StringBuffer.prototype.append=function(a){this.buffer.push(a);return this};StringBuffer.prototype.toString=function(){return this.buffer.join("")};
var Base64={codex:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var b=new StringBuffer;for(a=new Utf8EncodeEnumerator(a);a.moveNext();){var c=a.current;a.moveNext();var d=a.current;a.moveNext();var e=a.current,f=c>>2,c=(c&3)<<4|d>>4,h=(d&15)<<2|e>>6,g=e&63;isNaN(d)?h=g=64:isNaN(e)&&(g=64);b.append(this.codex.charAt(f)+this.codex.charAt(c)+this.codex.charAt(h)+this.codex.charAt(g))}return b.toString()},decode:function(a){var b=new StringBuffer;for(a=new Base64DecodeEnumerator(a);a.moveNext();){var c=
a.current;if(128>c)b.append(String.fromCharCode(c));else if(191<c&&224>c){a.moveNext();var d=a.current;b.append(String.fromCharCode((c&31)<<6|d&63))}else a.moveNext(),d=a.current,a.moveNext(),b.append(String.fromCharCode((c&15)<<12|(d&63)<<6|a.current&63))}return b.toString()}};function Utf8EncodeEnumerator(a){this._input=a;this._index=-1;this._buffer=[]}
Utf8EncodeEnumerator.prototype={current:Number.NaN,moveNext:function(){if(0<this._buffer.length)return this.current=this._buffer.shift(),!0;if(this._index>=this._input.length-1)return this.current=Number.NaN,!1;var a=this._input.charCodeAt(++this._index);13==a&&10==this._input.charCodeAt(this._index+1)&&(a=10,this._index+=2);128>a?this.current=a:(127<a&&2048>a?this.current=a>>6|192:(this.current=a>>12|224,this._buffer.push(a>>6&63|128)),this._buffer.push(a&63|128));return!0}};
function Base64DecodeEnumerator(a){this._input=a;this._index=-1;this._buffer=[]}
Base64DecodeEnumerator.prototype={current:64,moveNext:function(){if(0<this._buffer.length)return this.current=this._buffer.shift(),!0;if(this._index>=this._input.length-1)return this.current=64,!1;var a=Base64.codex.indexOf(this._input.charAt(++this._index)),b=Base64.codex.indexOf(this._input.charAt(++this._index)),c=Base64.codex.indexOf(this._input.charAt(++this._index)),d=Base64.codex.indexOf(this._input.charAt(++this._index)),e=(c&3)<<6|d;this.current=a<<2|b>>4;64!=c&&this._buffer.push((b&15)<<
4|c>>2);64!=d&&this._buffer.push(e);return!0}};
wApp={router:{params:{body:{}},parse_params:function(a){for(var b=a.length;b--;){var c=a[b].split("=");this.params[c[0]]=c[1].replace(/\+/g," ")}},routes:{},addRoutes:function(a){for(var b=Object.keys(a),c=b.length;c--;)if("resource"==b[c].split(" ")[0]){var d=this.createREST(b[c].split(" ")[1]);this.addRoutes(d)}else{var d={},e=b[c];d[e]=a[e];this.routes[e.replace(/:\w+/g,"(\\w+)")]=d}},createREST:function(a){var b={};b["GET /"+a]=a+"Controller#index";b["GET /"+a+"/new"]=a+"Controller#new";b["POST /"+
a]=a+"Controller#create";b["GET /"+a+"/:id"]=a+"Controller#show";b["GET /"+a+"/:id/edit"]=a+"Controller#edit";b["PUT /"+a+"/:id"]=a+"Controller#update";b["DELETE /"+a+"/:id"]=a+"Controller#delete";return b},pointRequest:function(a){keys=Object.keys(this.routes);for(var b=keys.length;b--;){var c=RegExp(keys[b].replace(/\//g,"\\/")+"$");if(a.match(c)){var d=this.routes[keys[b]],e=Object.keys(d)[0],f=e.match(/:(\w+)/g);if(f){a=a.match(c);a.shift();for(b=f.length;b--;)c=f[b],this.params[c.replace(":",
"")]=a[f.indexOf(c)]}return d[e]}}return"NOT FOUND"}},cookie_name:"v7App",cookie:{session:{}},session:{},oldcookie:{session:{}},sessionChanged:!1,setInSession:function(a,b){this.sessionChanged=!0;wApp.session[a]=b},setSession:function(){if(0!=Object.keys(this.session).length){var a=this.session.expires,b=this.session.path;delete this.session.expires;delete this.session.path;var c=Base64.encode(encodeURIComponent(JSON.stringify(this.session)))}else b=a=void 0;c=wApp.cookie_name+"="+c;void 0!=a&&(c+=
"; expires="+a.toGMTString());void 0!=b&&(c+="; path="+b);return"set-Cookie: "+c},getSession:function(a){var b={},c=wApp.cookie_name;if(a=a.match(RegExp(wApp.cookie_name+"=(\\w+)\\;?")))b[c]=a[1],b.session=JSON.parse(decodeURIComponent(Base64.decode(b[c]))),this.cookie=b,this.session=b.session;return b[c]},params:function(){return this.router.params}};
function http_parser(a){a=a.split("\r\n\r\n");for(var b=a[0].match(/^(GET|POST|PUT|DELETE|UPDATE) (.+) (.+)[\r\n]?/),c=a[0].replace(/^(GET|POST|PUT|DELETE|UPDATE) (.+) (.+)[\r\n]?/,""),d=/(.+): (.+)/g,e=/([^&]+)=([^&]+)/g,f=b[2].split("?"),b={verb:b[1],path:b[2],protocol:b[3],url:f[0],encodeParams:f[1],decodeParams:{},headers:{},body:{},bodyDecoded:{},cookie:""};header=d.exec(c);)b.headers[header[1]]=header[2];c=decodeURIComponent(b.encodeParams).replace(/\+/g," ");if(b.encodeParams)for(;param=e.exec(c);)b.decodeParams[param[1]]=
param[2];if(2==a.length)for(c=b.body=decodeURIComponent(a[1].trim().replace(/\+/g," "));body=e.exec(c);)b.bodyDecoded[body[1]]=body[2];return b}function Request(a){a=http_parser(a);wApp.router.params=a.decodeParams;wApp.router.params.body=a.bodyDecoded;void 0!=a.headers.Cookie&&wApp.getSession(a.headers.Cookie);return a}var BasicHeaders=["Server: Velneo v7","transfer-coding: chunked","Keep-Alive: timeout=5, max=94","Connection: Keep-Alive"];
function Response(a){try{var b=wApp.router.pointRequest(a.verb+" "+a.url);if("NOT FOUND"!=b)var c=b.split("#"),d=renderResponse(c[0],c[1],wApp);else d="HTTP/1.0 404 NOT FOUND";return d}catch(e){return a=logError(e),renderErrorResponse(e,a)}}
function renderResponse(a,b,c){a=c[a][b](c.router.params);a=(b=c.router.params.callback)?b+"("+JSON.stringify(a)+")":JSON.stringify(a);a=unescape(encodeURIComponent(a));b=["Date: "+(new Date).toGMTString(),"Content-Type: application/"+(b?"javascript":"json")+"; charset=utf-8","Content-Length: "+a.length,"Server: Velneo v7","transfer-coding: chunked","Keep-Alive: timeout=5, max=94","Connection: Keep-Alive"];c.sessionChanged&&b.push(c.setSession());return"HTTP/1.1 200 OK\r\n"+b.join("\r\n")+"\r\n\r\n"+
a}function logError(a){return void 0==a.lineNumber?a.message:a.message+". In Line Number: "+a.lineNumber}function renderErrorResponse(a,b){var c=wApp.router.params.callback,d={message:b},d=c?c+"("+JSON.stringify(d)+")":JSON.stringify(d),d=unescape(encodeURIComponent(d));return"HTTP/1.O 500  INTERNAL SERVER ERROR\r\n"+BasicHeaders.join("\r\n")+"\r\n\r\n"+d};